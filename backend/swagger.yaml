openapi: 3.0.0
info:
  title: Protek AI API
  version: 2.0.0
  description: API Documentation for Protek Predictive Maintenance System
servers:
  - url: http://localhost:4000
    description: Local Server

paths:
  # --- DASHBOARD ---
  /api/dashboard/stats:
    get:
      summary: Get Dashboard Statistics (Cards)
      tags: [Dashboard]
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  total: { type: integer }
                  healthy: { type: integer }
                  warning: { type: integer }
                  critical: { type: integer }
                  offline: { type: integer }

  /api/dashboard/machines:
    get:
      summary: Get Machine List for Dashboard Table
      tags: [Dashboard]
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/MachineOverview'

  # --- MACHINES ---
  /api/machines/{id}:
    get:
      summary: Get Machine Detail (Sensor + Prediction)
      tags: [Machines]
      parameters:
        - in: path
          name: id
          schema:
            type: string
          required: true
          description: Machine ID (e.g., M-14850) or ID (1)
      responses:
        200:
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MachineDetail'

  /api/machines/{id}/history:
    get:
      summary: Get Sensor History Chart Data
      tags: [Machines]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        200:
          description: OK

  # --- PREDICT ---
  /api/predict:
    post:
      summary: Receive Prediction Result from Python/ML
      tags: [Prediction]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                machine_id: { type: string, example: "M-14850" }
                risk_probability: { type: number, format: float, example: 0.85 }
                rul_estimate: { type: string, example: "2 Jam" }
                rul_minutes_val: { type: number, example: 120.5 }
                pred_status: { type: string, example: "CRITICAL" }
                failure_type: { type: string, example: "Overheating" }
                action: { type: string, example: "Check Coolant" }
                urgency: { type: string, example: "High" }
      responses:
        201:
          description: Created

  /api/predict/latest/{machineId}:
    get:
      summary: Get Latest Prediction by Machine ID
      tags: [Prediction]
      parameters:
        - in: path
          name: machineId
          required: true
          schema: { type: string }
      responses:
        200:
          description: OK

  # --- ALERTS ---
  /api/alerts:
    get:
      summary: Get All Active Alerts
      tags: [Alerts]
      responses:
        200:
          description: OK

  # --- CHATBOT ---
  /api/chat:
    post:
      summary: Chat with AI Copilot
      tags: [Chatbot]
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                message: { type: string, example: "Kondisi mesin M-14850 gimana?" }
      responses:
        200:
          description: AI Response

components:
  schemas:
    MachineOverview:
      type: object
      properties:
        id: { type: integer }
        machine_id: { type: string }
        name: { type: string }
        status: { type: string }
    MachineDetail:
      type: object
      allOf:
        - $ref: '#/components/schemas/MachineOverview'
        - type: object
          properties:
            sensor_data: { type: array }
            prediction_results: { type: array }
            alerts: { type: array }