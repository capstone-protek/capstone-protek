generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model machines {
  id                 Int                  @id @default(autoincrement())
  aset_id            String               @unique
  name               String
  status             MachineStatus        @default(OFFLINE)
  created_at         DateTime             @default(now())
  updated_at         DateTime             @updatedAt
  alerts             alerts[]
  prediction_results prediction_results[]
  sensor_data        sensor_data[]
}

model alerts {
  id         Int      @id @default(autoincrement())
  message    String
  severity   String
  timestamp  DateTime @default(now())
  machine_id Int
  machine    machines @relation(fields: [machine_id], references: [id], onDelete: Cascade)
}

model sensor_data {
  id                    Int      @id @default(autoincrement())
  machine_id            Int
  type                  String
  air_temperature_k     Float
  process_temperature_k Float
  rotational_speed_rpm  Int
  torque_nm             Float
  tool_wear_min         Int
  insertion_time        DateTime @default(now())
  machine               machines @relation(fields: [machine_id], references: [id], onDelete: Cascade)
}

model prediction_results {
  id               Int      @id @default(autoincrement())
  prediction_time  DateTime @default(now())
  machine_id       Int
  risk_probability Float
  rul_estimate     String
  rul_status       String
  rul_minutes_val  Float
  pred_status      String
  failure_type     String
  action           String
  urgency          String
  machines         machines @relation(fields: [machine_id], references: [id], onDelete: Cascade)
}

enum MachineStatus {
  CRITICAL
  WARNING
  HEALTHY
  OFFLINE
}
