
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Enum Status Mesin (Sesuai mockData)
enum MachineStatus {
  CRITICAL
  WARNING
  HEALTHY
  OFFLINE
}

// Model 1: Machine
model Machine {
  id            Int             @id @default(autoincrement())
  asetId        String          @unique // Contoh: "M-14850"
  name          String          // Contoh: "CNC Grinder 01"
  status        MachineStatus   @default(OFFLINE)
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt

  // Relasi
  alerts        Alert[]
  sensorHistory SensorHistory[]
}

// Model 2: Alert
model Alert {
  id        Int      @id @default(autoincrement())
  message   String
  severity  String   // "HIGH", "MEDIUM", "LOW"
  timestamp DateTime @default(now())
  
  // Relasi ke Machine
  machineId Int
  machine   Machine  @relation(fields: [machineId], references: [id])
}

// Model 3: SensorHistory (Sesuai request Notion)
model SensorHistory {
  id        Int      @id @default(autoincrement())
  type      String   // Misal: "Vibration"
  value     Float    // Misal: 85.5
  timestamp DateTime @default(now())

  // Relasi ke Machine
  machineId Int
  machine   Machine  @relation(fields: [machineId], references: [id])
}

// Model 4: sensor_data (sesuai dari API ML)
model sensor_data {

  // Kolom ID
  id                    Int       @id @default(autoincrement())
  
  // Kolom Sensor
  machine_id            Int
  type                  String    // Type (L, M, H)
  air_temperature_K     Float     
  process_temperature_K Float   
  rotational_speed_rpm  Int      
  torque_Nm             Float     
  tool_wear_min         Int       

  // Kolom Timestamp
  insertion_time        DateTime  @default(now())

  // Nama tabel di database
  @@map("sensor_data") 
}

// Model 5: prediction_results (sesuai dari API ML)
model prediction_results {
  id                Int       @id @default(autoincrement())
  prediction_time   DateTime  @default(now()) // Waktu prediksi
  machine_id        String    // Machine_ID (cth: M-14850)
  risk_probability  String    // Risk_Probability (cth: "78.3%")
  rul_estimate      String    // RUL_Estimate (cth: "0 Menit Lagi")
  rul_status        String    // RUL_Status (cth: "üö® CRITICAL")
  rul_minutes_val   Float     // RUL_Minutes (Nilai numerik 0, 162, dsb)
  pred_status       String    // Status (cth: "‚ö†Ô∏è CRITICAL FAILURE DETECTED")
  failure_type      String    // Failure_Type (cth: "Power Failure")
  action            String    // Action (cth: "Cek tegangan listrik...")
  urgency           String    // Urgency (cth: "üö® SANGAT MENDESAK...")

  // Nama tabel di database
  @@map("prediction_results")
}

