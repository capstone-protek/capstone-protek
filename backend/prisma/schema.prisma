
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Enum Status Mesin (Sesuai mockData)
enum MachineStatus {
  CRITICAL
  WARNING
  HEALTHY
  OFFLINE
}

// Model 1: machines (match table name)
model machines {
  id            Int             @id @default(autoincrement())
  aset_id       String          @unique // Contoh: "M-14850"
  name          String          // Contoh: "CNC Grinder 01"
  status        MachineStatus   @default(OFFLINE)
  created_at    DateTime        @default(now())
  updated_at    DateTime        @updatedAt

  // Relasi
  alerts        alerts[]
  sensor_data   sensor_data[]
}
// Model 2: alerts (match table name)
model alerts {
  id          Int      @id @default(autoincrement())
  message     String
  severity    String   // "HIGH", "MEDIUM", "LOW"
  timestamp   DateTime @default(now())

  // Relasi ke machines
  machine_id  Int
  machine     machines @relation(fields: [machine_id], references: [id])
}

// Sensor history dihapus (tidak digunakan)

// Model 3: sensor_data (sesuai dari API ML)
model sensor_data {
  id                    Int       @id @default(autoincrement())

  // Relasi ke machines via aset_id (string like "M-14850")
  machine_id            String
  machine               machines  @relation(fields: [machine_id], references: [aset_id])

  // Kolom Sensor
  type                  String    // Type (L, M, H)
  air_temperature_k     Float     
  process_temperature_k Float     
  rotational_speed_rpm  Int       
  torque_nm             Float     
  tool_wear_min         Int       

  // Kolom Timestamp
  insertion_time        DateTime  @default(now())
}

// Model 4: prediction_results (sesuai dari API ML)
model prediction_results {
  id                Int       @id @default(autoincrement())
  prediction_time   DateTime  @default(now()) // Waktu prediksi
  machine_id        String    // Machine_ID (cth: M-14850)
  risk_probability  String    // Risk_Probability (cth: "78.3%")
  rul_estimate      String    // RUL_Estimate (cth: "0 Menit Lagi")
  rul_status        String    // RUL_Status (cth: "üö® CRITICAL")
  rul_minutes_val   Float     // RUL_Minutes (Nilai numerik 0, 162, dsb)
  pred_status       String    // Status (cth: "‚ö†Ô∏è CRITICAL FAILURE DETECTED")
  failure_type      String    // Failure_Type (cth: "Power Failure")
  action            String    // Action (cth: "Cek tegangan listrik...")
  urgency           String    // Urgency (cth: "üö® SANGAT MENDESAK...")
}

