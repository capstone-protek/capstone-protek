generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum MachineStatus {
  CRITICAL
  WARNING
  HEALTHY
  OFFLINE
}

// Model 1: machines
model machines {
  id             Int                @id @default(autoincrement()) // Primary Key Internal (1, 2, 3...)
  machine_id     String             @unique // EX-ASET_ID (cth: "M-14850"). Wajib @unique!
  name           String
  status         MachineStatus      @default(OFFLINE)
  created_at     DateTime           @default(now())
  updated_at     DateTime           @updatedAt
  
  // Relasi
  alerts             alerts[]
  sensor_data        sensor_data[]
  prediction_results prediction_results[]
}

// Model 2: alerts
model alerts {
  id         Int      @id @default(autoincrement())
  message    String
  severity   String
  timestamp  DateTime @default(now())
  
  // Relasi merujuk ke machine_id (String)
  machine_id String   
  machine    machines @relation(fields: [machine_id], references: [machine_id])
}

// Model 3: sensor_data
model sensor_data {
  id                    Int      @id @default(autoincrement())
  
  // Relasi merujuk ke machine_id (String)
  machine_id            String   
  machine               machines @relation(fields: [machine_id], references: [machine_id])

  type                  String
  air_temperature_k     Float
  process_temperature_k Float
  rotational_speed_rpm  Int
  torque_nm             Float
  tool_wear_min         Int
  insertion_time        DateTime @default(now())
}

// Model 4: prediction_results
model prediction_results {
  id                Int      @id @default(autoincrement())
  prediction_time   DateTime @default(now())
  
  // Relasi merujuk ke machine_id (String)
  machine_id        String   
  machine           machines @relation(fields: [machine_id], references: [machine_id])

  risk_probability  Float
  rul_estimate      String
  rul_status        String
  rul_minutes_val   Float
  pred_status       String
  failure_type      String
  action            String
  urgency           String
}